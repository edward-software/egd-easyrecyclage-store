{% extends "::base_admin.html.twig" %}

{% block title %}
  {{ 'User.User.View'|trans }}
{% endblock %}

{% block stylesheets %}
  <link rel="stylesheet" type="text/css"
        href="{{ asset('/assets/vendor/datatables.net-bs/css/dataTables.bootstrap.min.css') }}">
  <link rel="stylesheet" type="text/css"
        href="{{ asset('/assets/vendor/datatables.net-select-bs/css/select.bootstrap.min.css') }}">
{% endblock %}

{% block content_title %}
  {{ 'User.User.Users'|trans }}
{% endblock %}

{% block main_content %}
  <div class="view-box row">

    {% for flashMessage in app.session.flashbag.get('errors') %}
      <div class="alert alert-danger">{{ ('User.User.Error.' ~ flashMessage)|trans }}</div>
    {% endfor %}

    {% for flashMessage in app.session.flashbag.get('success') %}
      <div class="alert alert-success">{{ ('User.User.Success.' ~ flashMessage)|trans }}</div>
    {% endfor %}

    <div class="col-md-12">
      <h4 class="view-sub-title"><i class="fa fa-list"></i> {{ 'User.User.View'|trans }} #{{ user.id }}</h4>

      <div class="view-tools pull-left">
        <a href="{{ path('paprec_user_user_index') }}" class="btn btn-default"><i class="fa fa-chevron-left"></i> {{ 'User.User.List'|trans }}</a>
      </div>
    </div>

    <div class="col-md-12">
      <h1 class="view-title">{{ user.username }}

        <div class="view-tools pull-right">

          <a id="userUserSendAccessButton" href="javascript:void(0);" class="btn btn-primary"><i
                    class="fa fa-envelope"></i> {{ 'User.User.Send-access'|trans }}</a>
          <a href="{{ path("paprec_user_user_edit", {id: user.id}) }}" class="btn btn-default"><i
                    class="fa fa-edit"></i> {{ 'User.User.Edit'|trans }}</a>
          <a id="userUserRemoveButton" href="javascript:void(0);" class="btn btn-danger"><i
                    class="fa fa-trash"></i> {{ 'User.User.Remove'|trans }}</a>

        </div>
      </h1>

      <div class="row">

        <div class="col-md-6">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">{{ 'User.User.Informations'|trans }}</h3>
            </div>
            <div class="panel-body">

              <div class="view-item">
                <div class="view-label">{{ 'User.User.Company-name'|trans }}</div>
                <div class="view-content">
                  {{ user.companyName }}
                </div>
              </div>

              <div class="view-item">
                <div class="view-label">{{ 'User.User.Username'|trans }}</div>
                <div class="view-content">
                  {{ user.username }}
                </div>
              </div>

              <div class="view-item">
                <div class="view-label">{{ 'User.User.First-name'|trans }}</div>
                <div class="view-content">
                  {{ user.firstName }}
                </div>
              </div>

              <div class="view-item">
                <div class="view-label">{{ 'User.User.Last-name'|trans }}</div>
                <div class="view-content">
                  {{ user.lastName }}
                </div>
              </div>

              <div class="view-item">
                <div class="view-label">{{ 'User.User.Email'|trans }}</div>
                <div class="view-content">
                  {{ user.email }}
                </div>
              </div>

            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">&nbsp;</h3>
            </div>
            <div class="panel-body">

              <div class="view-item">
                <div class="view-label">{{ 'User.User.Roles'|trans }}</div>
                <div class="view-content">
                  {% for role in user.roles %}
                    {% if role != 'ROLE_USER' %}
                      {{ role|trans }}<br>
                    {% endif %}
                  {% endfor %}
                </div>
              </div>

              <div class="view-item">
                <div class="view-label">{{ 'User.User.Enabled'|trans }}</div>
                <div class="view-content">
                  {% if user.enabled == 1 %}Oui{% else %}Non{% endif %}
                </div>
              </div>


            </div>
          </div>
        </div>

      </div>

      <div class="row">

        <div class="col-md-12">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">{{ 'User.User.System-informations'|trans }}</h3>
            </div>
            <div class="panel-body">

              <div class="view-item">
                <div class="view-label">{{ 'User.User.Date-creation'|trans }}</div>
                <div class="view-content">
                  {{ user.dateCreation|localizeddate('short', 'medium', app.request.locale) }}
                </div>
              </div>

              <div class="view-item">
                <div class="view-label">{{ 'User.User.Date-update'|trans }}</div>
                <div class="view-content">
                  {{ user.dateUpdate is empty ? "" : user.dateUpdate|localizeddate('short', 'medium', app.request.locale) }}
                </div>
              </div>

            </div>
          </div>


        </div>

      </div>

    </div>

  </div>



{% endblock %}

{% block javascripts %}

  <!-- DATA TABLES JS -->
  <script type="text/javascript"
          src="{{ asset('/assets/vendor/datatables.net/js/jquery.dataTables.min.js') }}"></script>
  <script type="text/javascript"
          src="{{ asset('/assets/vendor/datatables.net-bs/js/dataTables.bootstrap.min.js') }}"></script>
  <script type="text/javascript"
          src="{{ asset('/assets/vendor/datatables.net-select/js/dataTables.select.min.js') }}"></script>

  <script>
    $(function () {

      $('#userUserRemoveButton').on('click', function () {

        var url = "{{ path("paprec_user_user_remove", {id: user.id}) }}";

        bootbox.confirm("{{ 'User.User.Confirm-remove'|trans }}", function (result) {
          if (result === true) {
            $(location).attr('href', url);
          }
        });

      });

      $('#userUserSendAccessButton').on('click', function () {

        var url = "{{ path("paprec_user_user_sendAccess", {id: user.id}) }}";

        bootbox.confirm("{{ 'User.User.Confirm-send-access'|trans }}", function (result) {
          if (result === true) {
            $(location).attr('href', url);
          }
        });

      });

      var userList = $('#user-list-datatable').DataTable({
        "language": {
          "lengthMenu": "{{ 'General.Datatable.Records-per-page'|trans }}",
          "zeroRecords": "{{ 'General.Datatable.Nothing-found'|trans }}",
          "info": "{{ 'General.Datatable.Showing-page'|trans }}",
          "infoEmpty": "{{ 'General.Datatable.No-records-available'|trans }}",
          "search": "{{ 'General.Datatable.Search'|trans }}:",
          "sProcessing": "{{ 'General.Datatable.Loading'|trans }}",
          "paginate": {
            "previous": "{{ 'General.Datatable.Previous'|trans }}",
            "next": "{{ 'General.Datatable.Next'|trans }}",
          }
        },
        "select": true,
        "processing": true,
        "serverSide": true,
        "lengthMenu": [[50, 100, 200, 500], [50, 100, 200, 500]],
        "ajax": "{{ path('paprec_user_user_loadList', {'userId': user.id}) }}",
        "columns": [
          {"data": "id"},
          {"data": "dateCreation"},
          {"data": "status"},
          {"data": "number"},
          {"data": "username"},
          {"data": "totalPrice", className: "moneyValue"},
          {"data": "nbProduct"}
        ],
        "rowCallback": function (row, data, displayIndex) {
        },
        "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {

          $(nRow).find(':last-child').prev().html(parseFloat(aData['totalPrice']).toFixed(2));


        },
        "fnDrawCallback": function (oSettings) {

          if (userList.data().length > 0) {

            $.contextMenu({
              selector: '#user-list-datatable tbody tr',
              events: {
                show: function () {
                  userList.row('#' + this.prop('id')).select();
                }
              },
              callback: function (key, options) {
                var userIds = new Array();
                $('#user-list-datatable tbody tr.selected').each(function () {
                  userIds.push($(this).attr('id').replace('row_', ''));
                });

                if (key == 'add') {
                  {#url = "{{ path('paprec_user_user_add') }}";#}
                  {#$(location).attr('href', url);#}
                }
                else if (key == 'view') {
                  url = "{{ path('paprec_user_user_view', {id: '0000'}) }}".replace('0000', userIds[0]);
                  $(location).attr('href', url);
                }
                else if (key == 'edit') {
                  url = "{{ path('paprec_user_user_edit', {id: '0000'}) }}".replace('0000', userIds[0]);
                  $(location).attr('href', url);
                }
                else if (key == 'remove') {
                  bootbox.confirm("{{ 'User.User.Confirm-remove'|trans }}", function (result) {
                    if (result === true) {
                      url = "{{ path('paprec_user_user_remove', {id: '0000'}) }}".replace('0000', userIds[0]);
                      $(location).attr('href', url);
                    }
                  });
                }

              },
              items: {
                "view": {name: "{{ 'User.User.View'|trans }}", icon: "fa-search"},
                "edit": {name: "{{ 'User.User.Edit'|trans }}", icon: "edit"},
                "sep1": "---------",
                "remove": {name: "{{ 'User.User.Remove'|trans }}", icon: "delete"}
              }
            });
          }
        }
      });

    });
  </script>
{% endblock %}
